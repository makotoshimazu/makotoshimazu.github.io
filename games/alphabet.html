<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            position: relative;
            min-height: 100vh;
        }
        #char-display {
            font-size: clamp(100px, 30vw, 400px);
            line-height: 1;
            font-weight: 900;
            color: #3b82f6; /* blue-500 */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 70vh;
            user-select: none;
            /* ã‚¯ãƒªã‚¢å¾Œã‚‚ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ */
            min-height: clamp(100px, 30vw, 400px);
        }
        #message {
             min-height: 2rem; /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ã®é«˜ã•ã‚’ç¢ºä¿ */
             white-space: pre-wrap; /* æ”¹è¡Œã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
        }

        /* æ­£è§£æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .correct-typed {
            animation: pop 0.3s ease-out;
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #22c55e; } /* green-500 */
            100% { transform: scale(1); }
        }

        /* é–“é•ã„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚³ãƒ³ãƒ†ãƒŠ */
        #incorrect-popup-container {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
            pointer-events: none;
        }

        /* é–“é•ã„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¦ç´  */
        .incorrect-popup {
            @apply bg-red-100 text-red-600 border border-red-400 rounded-md px-3 py-1 text-2xl font-semibold shadow-md mb-2;
            animation: popup-up 1.5s ease-out forwards;
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes popup-up {
            0% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translateY(-80px); }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4" tabindex="0">

    <h1 class="text-2xl md:text-3xl font-bold mb-4 text-gray-700">è¡¨ç¤ºã•ã‚ŒãŸæ–‡å­—ã‚’ã‚¿ã‚¤ãƒ—ï¼</h1>

    <div id="char-display" class="mb-4">
        </div>

    <div id="message" class="text-xl h-auto text-center font-semibold text-gray-600"></div>

    <div id="incorrect-popup-container"></div>

    <script>
        // --- è¦ç´ ã®å–å¾— ---
        const charDisplay = document.getElementById('char-display');
        const messageEl = document.getElementById('message');
        const incorrectPopupContainer = document.getElementById('incorrect-popup-container');

        // --- ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ ---
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let currentTargetChar = '';
        let correctCount = 0; // æ­£è§£æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        const maxCorrectCount = 5; // ã‚¯ãƒªã‚¢ã«å¿…è¦ãªæ­£è§£æ•°
        let gameCleared = false; // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ãƒ•ãƒ©ã‚°

        // --- ã‚µã‚¦ãƒ³ãƒ‰ã®è¨­å®š (Tone.js) ---
        const correctSynth = new Tone.Synth().toDestination();
        const errorSynth = new Tone.Synth({
            oscillator: { type: 'square' },
            envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 }
        }).toDestination();
        errorSynth.volume.value = -6;
        // ã‚¯ãƒªã‚¢éŸ³ç”¨ã‚·ãƒ³ã‚»
        const clearSynth = new Tone.Synth({
             oscillator: { type: 'triangle' }, // ä¸‰è§’æ³¢ã§å°‘ã—æŸ”ã‚‰ã‹ã„éŸ³ã«
             envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.4 }
        }).toDestination();
        clearSynth.volume.value = -3; // å°‘ã—éŸ³é‡ã‚’ä¸Šã’ã‚‹

        // Tone.jsã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function ensureAudioContext() {
             if (Tone.context.state !== 'running') {
                Tone.start();
                // ä¸€åº¦ã ã‘ã‚¯ãƒªãƒƒã‚¯ãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                document.body.addEventListener('click', () => Tone.start(), { once: true });
            }
        }

        // æ­£è§£éŸ³ã‚’å†ç”Ÿ
        function playCorrectSound() {
            ensureAudioContext();
            correctSynth.triggerAttackRelease("G5", "8n", Tone.now());
        }

        // ä¸æ­£è§£éŸ³ï¼ˆãƒ–ãƒ¼ï¼‰ã‚’å†ç”Ÿ
        function playErrorSound() {
            ensureAudioContext();
            errorSynth.triggerAttackRelease("C3", "8n", Tone.now());
        }

        // ã‚¯ãƒªã‚¢éŸ³ï¼ˆãƒ†ãƒƒãƒ†ãƒ†ãƒ¼â™ªï¼‰ã‚’å†ç”Ÿ
        function playClearSound() {
            ensureAudioContext();
            const now = Tone.now();
            // ç°¡å˜ãªãƒ•ã‚¡ãƒ³ãƒ•ã‚¡ãƒ¼ãƒ¬ï¼ˆãƒ‰ãƒŸã‚½â†‘ãƒ‰ï¼‰
            clearSynth.triggerAttackRelease("C5", "8n", now);
            clearSynth.triggerAttackRelease("E5", "8n", now + 0.2);
            clearSynth.triggerAttackRelease("G5", "8n", now + 0.4);
            clearSynth.triggerAttackRelease("C6", "4n", now + 0.6); // æœ€å¾Œã®éŸ³ã‚’å°‘ã—é•·ã
        }

        // --- æ–°ã—ã„æ–‡å­—ã‚’è¡¨ç¤º ---
        function displayNewChar() {
            // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢å¾Œã¯æ–°ã—ã„æ–‡å­—ã‚’è¡¨ç¤ºã—ãªã„
            if (gameCleared) return;

            const randomIndex = Math.floor(Math.random() * characters.length);
            currentTargetChar = characters[randomIndex];
            charDisplay.textContent = currentTargetChar;
            charDisplay.classList.remove('correct-typed');
            void charDisplay.offsetWidth;
            messageEl.textContent = ''; // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
        }

        // --- é–“é•ã„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º ---
        function showIncorrectPopup(char) {
            const popup = document.createElement('div');
            popup.classList.add('incorrect-popup');
            popup.textContent = char;
            incorrectPopupContainer.appendChild(popup);

            setTimeout(() => {
                if (incorrectPopupContainer.contains(popup)) {
                    incorrectPopupContainer.removeChild(popup);
                }
            }, 1500);
        }

        // --- ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢å‡¦ç† ---
        function handleGameClear() {
            gameCleared = true;
            playClearSound(); // ã‚¯ãƒªã‚¢éŸ³ã‚’é³´ã‚‰ã™
            charDisplay.textContent = 'ğŸ‰'; // çµµæ–‡å­—ãªã©ã§ã‚¯ãƒªã‚¢è¡¨ç¤º
            charDisplay.classList.remove('correct-typed'); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            messageEl.textContent = `å…¨ã‚¯ãƒª ãŠã‚ã§ã¨ã†ï¼ (${maxCorrectCount}å›æˆåŠŸ)\nãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤`; // ã‚¯ãƒªã‚¢ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        }

        // --- ã‚­ãƒ¼å…¥åŠ›å‡¦ç† ---
        function handleKeyPress(event) {
            // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢å¾Œã¯ä½•ã‚‚ã—ãªã„
            if (gameCleared) {
                return;
            }

            // ä¿®é£¾ã‚­ãƒ¼ã‚„ç‰¹æ®Šã‚­ãƒ¼ã¯ç„¡è¦–
            if (event.key.length > 1 || event.metaKey || event.ctrlKey || event.altKey) {
                return;
            }

            const pressedKey = event.key.toUpperCase();

            if (pressedKey === currentTargetChar) {
                // --- æ­£è§£ ---
                playCorrectSound();
                messageEl.textContent = 'OK!';
                charDisplay.classList.add('correct-typed');
                correctCount++; // æ­£è§£æ•°ã‚’å¢—ã‚„ã™

                // ã‚¯ãƒªã‚¢æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯
                if (correctCount >= maxCorrectCount) {
                    // --- ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ ---
                    setTimeout(handleGameClear, 300); // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚¯ãƒªã‚¢å‡¦ç†
                } else {
                    // --- æ¬¡ã®æ–‡å­—ã¸ ---
                    // æ­£è§£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºå¾Œã€æ¬¡ã®æ–‡å­—ã‚’è¡¨ç¤º
                    setTimeout(() => {
                         displayNewChar();
                    }, 300); // 0.3ç§’å¾Œ
                }

            } else {
                // --- ä¸æ­£è§£ ---
                playErrorSound();
                messageEl.textContent = 'é•ã†ã‚ˆï¼';
                showIncorrectPopup(pressedKey);
            }
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---
        window.addEventListener('keydown', handleKeyPress);

        // --- åˆæœŸåŒ– ---
        displayNewChar(); // æœ€åˆã®æ–‡å­—ã‚’è¡¨ç¤º
        document.body.focus();
        document.body.addEventListener('click', () => {
            document.body.focus();
        });

    </script>

</body>
</html>
